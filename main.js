'use strict';

var obsidian = require('obsidian');
var crypto = require('crypto');

function _interopNamespace(e) {
    if (e && e.__esModule) return e;
    var n = Object.create(null);
    if (e) {
        Object.keys(e).forEach(function (k) {
            if (k !== 'default') {
                var d = Object.getOwnPropertyDescriptor(e, k);
                Object.defineProperty(n, k, d.get ? d : {
                    enumerable: true,
                    get: function () { return e[k]; }
                });
            }
        });
    }
    n["default"] = e;
    return Object.freeze(n);
}

var crypto__namespace = /*#__PURE__*/_interopNamespace(crypto);

/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
    var e = new Error(message);
    return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};

const VIEW_TYPE_STATS_TRACKER = "stats-tracker";

// const text = 'Hello, Obsidian!'
const secretKey = '!7iCQt*7(sLE$JW9';
const algorithm = 'aes-128-cbc';
const key = crypto__namespace.scryptSync(secretKey, 'salt', 16);
// // Hashing
// const hash = crypto.createHash('sha256').update(text).digest('hex')
// console.log('Hashed Text:', hash)
const encrypt = (text, version = 'v1') => {
    const iv = crypto__namespace.randomBytes(16);
    const cipher = crypto__namespace.createCipheriv(algorithm, key, iv);
    let encrypted = cipher.update(text, 'utf8', 'base64');
    encrypted += cipher.final('base64');
    const encryptedText = iv.toString('base64') + ':' + encrypted;
    // console.log('Encrypted Text:', encryptedText)
    return `${version}:${encryptedText}`;
};
const decrypt = (encryptedText) => {
    const [version, ivBase64, encryptedData] = encryptedText.split(':');
    // console.log('version', version)
    if (version !== 'v1') {
        throw new Error('Invalid version');
    }
    const ivBuffer = Buffer.from(ivBase64, 'base64');
    const decipher = crypto__namespace.createDecipheriv(algorithm, key, ivBuffer);
    let decrypted = decipher.update(encryptedData, 'base64', 'utf8');
    decrypted += decipher.final('utf8');
    // console.log('Decrypted Text:', decrypted)
    return decrypted;
};
const Encryption = () => {
    return { encrypt, decrypt };
};

function formatDateToYYYYMMDD(date) {
    // Extracting individual components
    const year = date.getFullYear();
    let month = String(date.getMonth() + 1); // Months are zero-based!
    let day = String(date.getDate());
    // Ensuring two-digit formats for month and day
    if (+month < 10) {
        month = '0' + month;
    }
    if (+day < 10) {
        day = '0' + day;
    }
    // Concatenating components in YYYY-MM-DD format
    return `${year}-${month}-${day}`;
}

function listAllPlugins(app) {
    const plugins = Object.values(app.plugins.plugins).map((plugin) => ({
        id: plugin.manifest.id,
        name: plugin.manifest.name,
        version: plugin.manifest.version,
    }));
    return plugins;
}

class DailyStatsSettingTab extends obsidian.PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
    }
    display() {
        const { containerEl } = this;
        containerEl.empty();
        containerEl.createEl('h2', { text: 'ObsiPulse Settings' });
        new obsidian.Setting(containerEl)
            .setName('License Key')
            .setDesc('Enter your license key to activate ObsiPulse plugin')
            .addText((text) => text
            .setPlaceholder('Your license key here...')
            .setValue(this.plugin.settings.key || '')
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.key = value;
            yield this.plugin.saveSettings();
            const parsedKey = parseLicenseKey(value);
            this.plugin.settings.userId = parsedKey.userId;
        })));
    }
}
const DEFAULT_SETTINGS = {
    dayCounts: {},
    todaysWordCount: {},
    userId: null,
};
const parseLicenseKey = (key) => {
    // console.log('--parsing key', key)
    const parsedKey = Encryption().decrypt(key);
    // console.log({ parsedKey })
    try {
        const value = JSON.parse(parsedKey);
        console.log({ value });
        return value;
    }
    catch (e) {
        console.error('--error decrypting key', e);
    }
};
class DailyStats extends obsidian.Plugin {
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            console.log('--Obsidian Export Stats Plugin Loaded');
            // console.log({
            //   dir: this.app.vault.configDir,
            //   root: this.app.vault.getRoot(),
            //   dirname: __dirname,
            //   name: this.app.vault.adapter.getName(),
            //   path: this.app.vault.adapter.basePath,
            //   id: this.app.appId,
            // })
            yield this.loadSettings();
            // const key = Encryption().encrypt(
            //   JSON.stringify({ key: '6KAcZY2y658x559oAmbNmL5840oxQo', userId: '0b3417c00370b98c' }),
            // )
            // console.log({ key, l: key.length })
            // const testKey = Encryption().decrypt(key)
            // console.log({ testKey })
            // parseLicenseKey(key)
            if (this.settings.key) {
                try {
                    const parsedKey = parseLicenseKey(this.settings.key);
                    this.settings.userId = parsedKey.userId;
                    new obsidian.Notice('ObsiPulse plugin has been loaded!');
                    this.onLicenseKeyUpdate();
                }
                catch (e) {
                    console.error('--error parsing key', e, this.settings.key);
                    new obsidian.Notice('Invalid licence key for ObsiPulse plugin');
                }
            }
            else {
                new obsidian.Notice('Missing licence key for ObsiPulse plugin');
            }
            this.statusBarEl = this.addStatusBarItem();
            this.updateDate();
            if (this.settings.dayCounts.hasOwnProperty(this.today)) {
                this.updateCounts();
            }
            else {
                this.currentWordCount = 0;
            }
            this.debouncedUpdate = obsidian.debounce((contents, filepath) => {
                this.updateWordCount(contents, filepath);
            }, 
            // 400,
            1000, false);
            this.debouncedUpdateDb = obsidian.debounce((key, value) => {
                this.updateDb(key, value);
            }, 1000, false);
            this.registerEvent(this.app.workspace.on('quick-preview', this.onQuickPreview.bind(this)));
            this.registerInterval(window.setInterval(() => {
                this.statusBarEl.setText(this.currentWordCount + ' words today ');
            }, 2000));
            this.registerInterval(window.setInterval(() => {
                this.updateDate();
                this.saveSettings();
            }, 5000));
            if (this.app.workspace.layoutReady) {
                this.initLeaf();
            }
            else {
                this.registerEvent(this.app.workspace.on('layout-ready', this.initLeaf.bind(this)));
            }
            this.addCommand({
                id: 'open-obsipulse',
                name: 'Open ObsiPulse Profile',
                callback: () => {
                    if (!this.settings.userId) {
                        return new obsidian.Notice('Missing licence key for ObsiPulse plugin');
                    }
                    window.open(`https://www.obsipulse.com/profile/${this.settings.userId}`, '_blank');
                },
            });
            this.addSettingTab(new DailyStatsSettingTab(this.app, this));
        });
    }
    onLicenseKeyUpdate() {
        // TODO: refresh user plugins list on update
        if (this.settings.userId) {
            const plugins = listAllPlugins(this.app);
            this.updateDb(`user/${this.settings.userId}/vault/${this.app.vault.adapter.getName()}/plugins`, JSON.stringify(plugins));
        }
    }
    initLeaf() {
        if (this.app.workspace.getLeavesOfType(VIEW_TYPE_STATS_TRACKER).length) {
            return;
        }
    }
    onQuickPreview(file, contents) {
        if (this.app.workspace.getActiveViewOfType(obsidian.MarkdownView)) {
            this.debouncedUpdate(contents, file.path);
        }
    }
    //Credit: better-word-count by Luke Leppan (https://github.com/lukeleppan/better-word-count)
    getWordCount(text) {
        let words = 0;
        const matches = text.match(/[a-zA-Z0-9_\u0392-\u03c9\u00c0-\u00ff\u0600-\u06ff]+|[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/gm);
        if (matches) {
            for (let i = 0; i < matches.length; i++) {
                if (matches[i].charCodeAt(0) > 19968) {
                    words += matches[i].length;
                }
                else {
                    words += 1;
                }
            }
        }
        console.log('text----', text, words, text === null || text === void 0 ? void 0 : text.length);
        return words;
    }
    updateWordCount(contents, filepath) {
        console.time('wordCount');
        const curr = this.getWordCount(contents);
        console.timeEnd('wordCount');
        if (this.settings.dayCounts.hasOwnProperty(this.today)) {
            if (this.settings.todaysWordCount.hasOwnProperty(filepath)) {
                //updating existing file
                this.settings.todaysWordCount[filepath].current = curr;
            }
            else {
                //created new file during session
                this.settings.todaysWordCount[filepath] = { initial: curr, current: curr };
            }
        }
        else {
            //new day, flush the cache
            this.settings.todaysWordCount = {};
            this.settings.todaysWordCount[filepath] = { initial: curr, current: curr };
        }
        this.updateCounts();
    }
    updateDate() {
        this.today = formatDateToYYYYMMDD(new Date());
    }
    updateCounts() {
        this.currentWordCount = Object.values(this.settings.todaysWordCount)
            .map((wordCount) => Math.max(0, wordCount.current - wordCount.initial))
            .reduce((a, b) => a + b, 0);
        this.settings.dayCounts[this.today] = this.currentWordCount;
        console.log('---word count updated', this.currentWordCount, this.settings.dayCounts, this.settings);
        if (this.debouncedUpdateDb && this.settings.userId) {
            this.debouncedUpdateDb(`user/${this.settings.userId}/vault/${this.app.vault.adapter.getName()}/daily-counts`, JSON.stringify(this.settings.dayCounts));
        }
    }
    updateDb(key, value) {
        return __awaiter(this, void 0, void 0, function* () {
            // console.log('---calling update db')
            return obsidian.requestUrl({
                method: 'POST',
                url: `https://mypi.one/webhook/424317ea-705c-41e4-b97b-441337d46f59`,
                headers: {
                    'content-type': 'application/json',
                },
                body: JSON.stringify({
                    key,
                    value,
                }),
            })
                .then((result) => {
                console.log('--db update done', result);
            })
                .catch(console.error);
        });
    }
    loadSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
        });
    }
    saveSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            if (Object.keys(this.settings.dayCounts).length > 0) {
                //ensuring we never reset the data by accident
                yield this.saveData(this.settings);
            }
        });
    }
}

module.exports = DailyStats;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsInNyYy9jb25zdGFudHMudHMiLCJzcmMvaGVscGVycy9FbmNyeXB0aW9uLnRzIiwic3JjL2hlbHBlcnMvZm9ybWF0RGF0ZVRvWVlZWU1NREQudHMiLCJzcmMvaGVscGVycy9saXN0QWxsUGx1Z2lucy50cyIsInNyYy9tYWluLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSwgU3VwcHJlc3NlZEVycm9yLCBTeW1ib2wgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH1cclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcclxuICAgIHZhciB0ID0ge307XHJcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcclxuICAgICAgICB0W3BdID0gc1twXTtcclxuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcclxuICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xyXG4gICAgICAgIH1cclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXNEZWNvcmF0ZShjdG9yLCBkZXNjcmlwdG9ySW4sIGRlY29yYXRvcnMsIGNvbnRleHRJbiwgaW5pdGlhbGl6ZXJzLCBleHRyYUluaXRpYWxpemVycykge1xyXG4gICAgZnVuY3Rpb24gYWNjZXB0KGYpIHsgaWYgKGYgIT09IHZvaWQgMCAmJiB0eXBlb2YgZiAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRnVuY3Rpb24gZXhwZWN0ZWRcIik7IHJldHVybiBmOyB9XHJcbiAgICB2YXIga2luZCA9IGNvbnRleHRJbi5raW5kLCBrZXkgPSBraW5kID09PSBcImdldHRlclwiID8gXCJnZXRcIiA6IGtpbmQgPT09IFwic2V0dGVyXCIgPyBcInNldFwiIDogXCJ2YWx1ZVwiO1xyXG4gICAgdmFyIHRhcmdldCA9ICFkZXNjcmlwdG9ySW4gJiYgY3RvciA/IGNvbnRleHRJbltcInN0YXRpY1wiXSA/IGN0b3IgOiBjdG9yLnByb3RvdHlwZSA6IG51bGw7XHJcbiAgICB2YXIgZGVzY3JpcHRvciA9IGRlc2NyaXB0b3JJbiB8fCAodGFyZ2V0ID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGNvbnRleHRJbi5uYW1lKSA6IHt9KTtcclxuICAgIHZhciBfLCBkb25lID0gZmFsc2U7XHJcbiAgICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgIHZhciBjb250ZXh0ID0ge307XHJcbiAgICAgICAgZm9yICh2YXIgcCBpbiBjb250ZXh0SW4pIGNvbnRleHRbcF0gPSBwID09PSBcImFjY2Vzc1wiID8ge30gOiBjb250ZXh0SW5bcF07XHJcbiAgICAgICAgZm9yICh2YXIgcCBpbiBjb250ZXh0SW4uYWNjZXNzKSBjb250ZXh0LmFjY2Vzc1twXSA9IGNvbnRleHRJbi5hY2Nlc3NbcF07XHJcbiAgICAgICAgY29udGV4dC5hZGRJbml0aWFsaXplciA9IGZ1bmN0aW9uIChmKSB7IGlmIChkb25lKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGFkZCBpbml0aWFsaXplcnMgYWZ0ZXIgZGVjb3JhdGlvbiBoYXMgY29tcGxldGVkXCIpOyBleHRyYUluaXRpYWxpemVycy5wdXNoKGFjY2VwdChmIHx8IG51bGwpKTsgfTtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gKDAsIGRlY29yYXRvcnNbaV0pKGtpbmQgPT09IFwiYWNjZXNzb3JcIiA/IHsgZ2V0OiBkZXNjcmlwdG9yLmdldCwgc2V0OiBkZXNjcmlwdG9yLnNldCB9IDogZGVzY3JpcHRvcltrZXldLCBjb250ZXh0KTtcclxuICAgICAgICBpZiAoa2luZCA9PT0gXCJhY2Nlc3NvclwiKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgY29udGludWU7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IG51bGwgfHwgdHlwZW9mIHJlc3VsdCAhPT0gXCJvYmplY3RcIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIk9iamVjdCBleHBlY3RlZFwiKTtcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmdldCkpIGRlc2NyaXB0b3IuZ2V0ID0gXztcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LnNldCkpIGRlc2NyaXB0b3Iuc2V0ID0gXztcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmluaXQpKSBpbml0aWFsaXplcnMudW5zaGlmdChfKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoXyA9IGFjY2VwdChyZXN1bHQpKSB7XHJcbiAgICAgICAgICAgIGlmIChraW5kID09PSBcImZpZWxkXCIpIGluaXRpYWxpemVycy51bnNoaWZ0KF8pO1xyXG4gICAgICAgICAgICBlbHNlIGRlc2NyaXB0b3Jba2V5XSA9IF87XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRhcmdldCkgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgY29udGV4dEluLm5hbWUsIGRlc2NyaXB0b3IpO1xyXG4gICAgZG9uZSA9IHRydWU7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19ydW5Jbml0aWFsaXplcnModGhpc0FyZywgaW5pdGlhbGl6ZXJzLCB2YWx1ZSkge1xyXG4gICAgdmFyIHVzZVZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluaXRpYWxpemVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhbHVlID0gdXNlVmFsdWUgPyBpbml0aWFsaXplcnNbaV0uY2FsbCh0aGlzQXJnLCB2YWx1ZSkgOiBpbml0aWFsaXplcnNbaV0uY2FsbCh0aGlzQXJnKTtcclxuICAgIH1cclxuICAgIHJldHVybiB1c2VWYWx1ZSA/IHZhbHVlIDogdm9pZCAwO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcHJvcEtleSh4KSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHggPT09IFwic3ltYm9sXCIgPyB4IDogXCJcIi5jb25jYXQoeCk7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zZXRGdW5jdGlvbk5hbWUoZiwgbmFtZSwgcHJlZml4KSB7XHJcbiAgICBpZiAodHlwZW9mIG5hbWUgPT09IFwic3ltYm9sXCIpIG5hbWUgPSBuYW1lLmRlc2NyaXB0aW9uID8gXCJbXCIuY29uY2F0KG5hbWUuZGVzY3JpcHRpb24sIFwiXVwiKSA6IFwiXCI7XHJcbiAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGYsIFwibmFtZVwiLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IHByZWZpeCA/IFwiXCIuY29uY2F0KHByZWZpeCwgXCIgXCIsIG5hbWUpIDogbmFtZSB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoZyAmJiAoZyA9IDAsIG9wWzBdICYmIChfID0gMCkpLCBfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19jcmVhdGVCaW5kaW5nID0gT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtLCBrKTtcclxuICAgIGlmICghZGVzYyB8fCAoXCJnZXRcIiBpbiBkZXNjID8gIW0uX19lc01vZHVsZSA6IGRlc2Mud3JpdGFibGUgfHwgZGVzYy5jb25maWd1cmFibGUpKSB7XHJcbiAgICAgICAgZGVzYyA9IHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfTtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgZGVzYyk7XHJcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgb1trMl0gPSBtW2tdO1xyXG59KTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4cG9ydFN0YXIobSwgbykge1xyXG4gICAgZm9yICh2YXIgcCBpbiBtKSBpZiAocCAhPT0gXCJkZWZhdWx0XCIgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLCBwKSkgX19jcmVhdGVCaW5kaW5nKG8sIG0sIHApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX192YWx1ZXMobykge1xyXG4gICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDtcclxuICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pO1xyXG4gICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSBcIm51bWJlclwiKSByZXR1cm4ge1xyXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyBcIk9iamVjdCBpcyBub3QgaXRlcmFibGUuXCIgOiBcIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3JlYWQobywgbikge1xyXG4gICAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdO1xyXG4gICAgaWYgKCFtKSByZXR1cm4gbztcclxuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnJvcikgeyBlID0geyBlcnJvcjogZXJyb3IgfTsgfVxyXG4gICAgZmluYWxseSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKHIgJiYgIXIuZG9uZSAmJiAobSA9IGlbXCJyZXR1cm5cIl0pKSBtLmNhbGwoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFyO1xyXG59XHJcblxyXG4vKiogQGRlcHJlY2F0ZWQgKi9cclxuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkKCkge1xyXG4gICAgZm9yICh2YXIgYXIgPSBbXSwgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgYXIgPSBhci5jb25jYXQoX19yZWFkKGFyZ3VtZW50c1tpXSkpO1xyXG4gICAgcmV0dXJuIGFyO1xyXG59XHJcblxyXG4vKiogQGRlcHJlY2F0ZWQgKi9cclxuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkQXJyYXlzKCkge1xyXG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XHJcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXHJcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXHJcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xyXG4gICAgcmV0dXJuIHI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5KHRvLCBmcm9tLCBwYWNrKSB7XHJcbiAgICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgIGlmIChhciB8fCAhKGkgaW4gZnJvbSkpIHtcclxuICAgICAgICAgICAgaWYgKCFhcikgYXIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tLCAwLCBpKTtcclxuICAgICAgICAgICAgYXJbaV0gPSBmcm9tW2ldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdCh2KSB7XHJcbiAgICByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIF9fYXdhaXQgPyAodGhpcy52ID0gdiwgdGhpcykgOiBuZXcgX19hd2FpdCh2KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNHZW5lcmF0b3IodGhpc0FyZywgX2FyZ3VtZW50cywgZ2VuZXJhdG9yKSB7XHJcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgdmFyIGcgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSksIGksIHEgPSBbXTtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpZiAoZ1tuXSkgaVtuXSA9IGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoYSwgYikgeyBxLnB1c2goW24sIHYsIGEsIGJdKSA+IDEgfHwgcmVzdW1lKG4sIHYpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gcmVzdW1lKG4sIHYpIHsgdHJ5IHsgc3RlcChnW25dKHYpKTsgfSBjYXRjaCAoZSkgeyBzZXR0bGUocVswXVszXSwgZSk7IH0gfVxyXG4gICAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9XHJcbiAgICBmdW5jdGlvbiBmdWxmaWxsKHZhbHVlKSB7IHJlc3VtZShcIm5leHRcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKFwidGhyb3dcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiBzZXR0bGUoZiwgdikgeyBpZiAoZih2KSwgcS5zaGlmdCgpLCBxLmxlbmd0aCkgcmVzdW1lKHFbMF1bMF0sIHFbMF1bMV0pOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jRGVsZWdhdG9yKG8pIHtcclxuICAgIHZhciBpLCBwO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiLCBmdW5jdGlvbiAoZSkgeyB0aHJvdyBlOyB9KSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobiwgZikgeyBpW25dID0gb1tuXSA/IGZ1bmN0aW9uICh2KSB7IHJldHVybiAocCA9ICFwKSA/IHsgdmFsdWU6IF9fYXdhaXQob1tuXSh2KSksIGRvbmU6IGZhbHNlIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xyXG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRTZXQocmVjZWl2ZXIsIHN0YXRlLCB2YWx1ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwibVwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlXCIpO1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiAoa2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIsIHZhbHVlKSA6IGYgPyBmLnZhbHVlID0gdmFsdWUgOiBzdGF0ZS5zZXQocmVjZWl2ZXIsIHZhbHVlKSksIHZhbHVlO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEluKHN0YXRlLCByZWNlaXZlcikge1xyXG4gICAgaWYgKHJlY2VpdmVyID09PSBudWxsIHx8ICh0eXBlb2YgcmVjZWl2ZXIgIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHJlY2VpdmVyICE9PSBcImZ1bmN0aW9uXCIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHVzZSAnaW4nIG9wZXJhdG9yIG9uIG5vbi1vYmplY3RcIik7XHJcbiAgICByZXR1cm4gdHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciA9PT0gc3RhdGUgOiBzdGF0ZS5oYXMocmVjZWl2ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hZGREaXNwb3NhYmxlUmVzb3VyY2UoZW52LCB2YWx1ZSwgYXN5bmMpIHtcclxuICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgdmFsdWUgIT09IFwiZnVuY3Rpb25cIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIk9iamVjdCBleHBlY3RlZC5cIik7XHJcbiAgICAgICAgdmFyIGRpc3Bvc2U7XHJcbiAgICAgICAgaWYgKGFzeW5jKSB7XHJcbiAgICAgICAgICAgIGlmICghU3ltYm9sLmFzeW5jRGlzcG9zZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0Rpc3Bvc2UgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgICAgICAgICBkaXNwb3NlID0gdmFsdWVbU3ltYm9sLmFzeW5jRGlzcG9zZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkaXNwb3NlID09PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgaWYgKCFTeW1ib2wuZGlzcG9zZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5kaXNwb3NlIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgICAgICAgICAgZGlzcG9zZSA9IHZhbHVlW1N5bWJvbC5kaXNwb3NlXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBkaXNwb3NlICE9PSBcImZ1bmN0aW9uXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJPYmplY3Qgbm90IGRpc3Bvc2FibGUuXCIpO1xyXG4gICAgICAgIGVudi5zdGFjay5wdXNoKHsgdmFsdWU6IHZhbHVlLCBkaXNwb3NlOiBkaXNwb3NlLCBhc3luYzogYXN5bmMgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChhc3luYykge1xyXG4gICAgICAgIGVudi5zdGFjay5wdXNoKHsgYXN5bmM6IHRydWUgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbn1cclxuXHJcbnZhciBfU3VwcHJlc3NlZEVycm9yID0gdHlwZW9mIFN1cHByZXNzZWRFcnJvciA9PT0gXCJmdW5jdGlvblwiID8gU3VwcHJlc3NlZEVycm9yIDogZnVuY3Rpb24gKGVycm9yLCBzdXBwcmVzc2VkLCBtZXNzYWdlKSB7XHJcbiAgICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTtcclxuICAgIHJldHVybiBlLm5hbWUgPSBcIlN1cHByZXNzZWRFcnJvclwiLCBlLmVycm9yID0gZXJyb3IsIGUuc3VwcHJlc3NlZCA9IHN1cHByZXNzZWQsIGU7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kaXNwb3NlUmVzb3VyY2VzKGVudikge1xyXG4gICAgZnVuY3Rpb24gZmFpbChlKSB7XHJcbiAgICAgICAgZW52LmVycm9yID0gZW52Lmhhc0Vycm9yID8gbmV3IF9TdXBwcmVzc2VkRXJyb3IoZSwgZW52LmVycm9yLCBcIkFuIGVycm9yIHdhcyBzdXBwcmVzc2VkIGR1cmluZyBkaXNwb3NhbC5cIikgOiBlO1xyXG4gICAgICAgIGVudi5oYXNFcnJvciA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBuZXh0KCkge1xyXG4gICAgICAgIHdoaWxlIChlbnYuc3RhY2subGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHZhciByZWMgPSBlbnYuc3RhY2sucG9wKCk7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVjLmRpc3Bvc2UgJiYgcmVjLmRpc3Bvc2UuY2FsbChyZWMudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlYy5hc3luYykgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpLnRoZW4obmV4dCwgZnVuY3Rpb24oZSkgeyBmYWlsKGUpOyByZXR1cm4gbmV4dCgpOyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgZmFpbChlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW52Lmhhc0Vycm9yKSB0aHJvdyBlbnYuZXJyb3I7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV4dCgpO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBfX2V4dGVuZHM6IF9fZXh0ZW5kcyxcclxuICAgIF9fYXNzaWduOiBfX2Fzc2lnbixcclxuICAgIF9fcmVzdDogX19yZXN0LFxyXG4gICAgX19kZWNvcmF0ZTogX19kZWNvcmF0ZSxcclxuICAgIF9fcGFyYW06IF9fcGFyYW0sXHJcbiAgICBfX21ldGFkYXRhOiBfX21ldGFkYXRhLFxyXG4gICAgX19hd2FpdGVyOiBfX2F3YWl0ZXIsXHJcbiAgICBfX2dlbmVyYXRvcjogX19nZW5lcmF0b3IsXHJcbiAgICBfX2NyZWF0ZUJpbmRpbmc6IF9fY3JlYXRlQmluZGluZyxcclxuICAgIF9fZXhwb3J0U3RhcjogX19leHBvcnRTdGFyLFxyXG4gICAgX192YWx1ZXM6IF9fdmFsdWVzLFxyXG4gICAgX19yZWFkOiBfX3JlYWQsXHJcbiAgICBfX3NwcmVhZDogX19zcHJlYWQsXHJcbiAgICBfX3NwcmVhZEFycmF5czogX19zcHJlYWRBcnJheXMsXHJcbiAgICBfX3NwcmVhZEFycmF5OiBfX3NwcmVhZEFycmF5LFxyXG4gICAgX19hd2FpdDogX19hd2FpdCxcclxuICAgIF9fYXN5bmNHZW5lcmF0b3I6IF9fYXN5bmNHZW5lcmF0b3IsXHJcbiAgICBfX2FzeW5jRGVsZWdhdG9yOiBfX2FzeW5jRGVsZWdhdG9yLFxyXG4gICAgX19hc3luY1ZhbHVlczogX19hc3luY1ZhbHVlcyxcclxuICAgIF9fbWFrZVRlbXBsYXRlT2JqZWN0OiBfX21ha2VUZW1wbGF0ZU9iamVjdCxcclxuICAgIF9faW1wb3J0U3RhcjogX19pbXBvcnRTdGFyLFxyXG4gICAgX19pbXBvcnREZWZhdWx0OiBfX2ltcG9ydERlZmF1bHQsXHJcbiAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0OiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0LFxyXG4gICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldDogX19jbGFzc1ByaXZhdGVGaWVsZFNldCxcclxuICAgIF9fY2xhc3NQcml2YXRlRmllbGRJbjogX19jbGFzc1ByaXZhdGVGaWVsZEluLFxyXG4gICAgX19hZGREaXNwb3NhYmxlUmVzb3VyY2U6IF9fYWRkRGlzcG9zYWJsZVJlc291cmNlLFxyXG4gICAgX19kaXNwb3NlUmVzb3VyY2VzOiBfX2Rpc3Bvc2VSZXNvdXJjZXMsXHJcbn07XHJcbiIsImV4cG9ydCBjb25zdCBWSUVXX1RZUEVfU1RBVFNfVFJBQ0tFUiA9IFwic3RhdHMtdHJhY2tlclwiO1xuZXhwb3J0IGNvbnN0IE1BWF9DT0xPUlMgPSA1O1xuZXhwb3J0IGNvbnN0IENPTE9SX0ZSRVEgPSA2O1xuIiwiaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gJ2NyeXB0bydcblxuLy8gY29uc3QgdGV4dCA9ICdIZWxsbywgT2JzaWRpYW4hJ1xuY29uc3Qgc2VjcmV0S2V5ID0gJyE3aUNRdCo3KHNMRSRKVzknXG5jb25zdCBhbGdvcml0aG0gPSAnYWVzLTEyOC1jYmMnXG5jb25zdCBrZXkgPSBjcnlwdG8uc2NyeXB0U3luYyhzZWNyZXRLZXksICdzYWx0JywgMTYpXG4vLyAvLyBIYXNoaW5nXG4vLyBjb25zdCBoYXNoID0gY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZSh0ZXh0KS5kaWdlc3QoJ2hleCcpXG4vLyBjb25zb2xlLmxvZygnSGFzaGVkIFRleHQ6JywgaGFzaClcblxuY29uc3QgZW5jcnlwdCA9ICh0ZXh0OiBzdHJpbmcsIHZlcnNpb24gPSAndjEnKSA9PiB7XG4gIGNvbnN0IGl2ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDE2KVxuXG4gIGNvbnN0IGNpcGhlciA9IGNyeXB0by5jcmVhdGVDaXBoZXJpdihhbGdvcml0aG0sIGtleSwgaXYpXG4gIGxldCBlbmNyeXB0ZWQgPSBjaXBoZXIudXBkYXRlKHRleHQsICd1dGY4JywgJ2Jhc2U2NCcpXG4gIGVuY3J5cHRlZCArPSBjaXBoZXIuZmluYWwoJ2Jhc2U2NCcpXG4gIGNvbnN0IGVuY3J5cHRlZFRleHQgPSBpdi50b1N0cmluZygnYmFzZTY0JykgKyAnOicgKyBlbmNyeXB0ZWRcbiAgLy8gY29uc29sZS5sb2coJ0VuY3J5cHRlZCBUZXh0OicsIGVuY3J5cHRlZFRleHQpXG4gIHJldHVybiBgJHt2ZXJzaW9ufToke2VuY3J5cHRlZFRleHR9YFxufVxuXG5jb25zdCBkZWNyeXB0ID0gKGVuY3J5cHRlZFRleHQ6IHN0cmluZykgPT4ge1xuICBjb25zdCBbdmVyc2lvbiwgaXZCYXNlNjQsIGVuY3J5cHRlZERhdGFdID0gZW5jcnlwdGVkVGV4dC5zcGxpdCgnOicpXG4gIC8vIGNvbnNvbGUubG9nKCd2ZXJzaW9uJywgdmVyc2lvbilcbiAgaWYgKHZlcnNpb24gIT09ICd2MScpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdmVyc2lvbicpXG4gIH1cbiAgY29uc3QgaXZCdWZmZXIgPSBCdWZmZXIuZnJvbShpdkJhc2U2NCwgJ2Jhc2U2NCcpXG4gIGNvbnN0IGRlY2lwaGVyID0gY3J5cHRvLmNyZWF0ZURlY2lwaGVyaXYoYWxnb3JpdGhtLCBrZXksIGl2QnVmZmVyKVxuICBsZXQgZGVjcnlwdGVkID0gZGVjaXBoZXIudXBkYXRlKGVuY3J5cHRlZERhdGEsICdiYXNlNjQnLCAndXRmOCcpXG4gIGRlY3J5cHRlZCArPSBkZWNpcGhlci5maW5hbCgndXRmOCcpXG4gIC8vIGNvbnNvbGUubG9nKCdEZWNyeXB0ZWQgVGV4dDonLCBkZWNyeXB0ZWQpXG4gIHJldHVybiBkZWNyeXB0ZWRcbn1cblxuZXhwb3J0IGNvbnN0IEVuY3J5cHRpb24gPSAoKSA9PiB7XG4gIHJldHVybiB7IGVuY3J5cHQsIGRlY3J5cHQgfVxufVxuIiwiZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERhdGVUb1lZWVlNTUREKGRhdGU6IERhdGUpIHtcbiAgLy8gRXh0cmFjdGluZyBpbmRpdmlkdWFsIGNvbXBvbmVudHNcbiAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKVxuICBsZXQgbW9udGggPSBTdHJpbmcoZGF0ZS5nZXRNb250aCgpICsgMSkgLy8gTW9udGhzIGFyZSB6ZXJvLWJhc2VkIVxuICBsZXQgZGF5ID0gU3RyaW5nKGRhdGUuZ2V0RGF0ZSgpKVxuXG4gIC8vIEVuc3VyaW5nIHR3by1kaWdpdCBmb3JtYXRzIGZvciBtb250aCBhbmQgZGF5XG4gIGlmICgrbW9udGggPCAxMCkge1xuICAgIG1vbnRoID0gJzAnICsgbW9udGhcbiAgfVxuXG4gIGlmICgrZGF5IDwgMTApIHtcbiAgICBkYXkgPSAnMCcgKyBkYXlcbiAgfVxuXG4gIC8vIENvbmNhdGVuYXRpbmcgY29tcG9uZW50cyBpbiBZWVlZLU1NLUREIGZvcm1hdFxuICByZXR1cm4gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YFxufVxuIiwiaW1wb3J0IHsgQXBwIH0gZnJvbSAnb2JzaWRpYW4nXG5cbmV4cG9ydCBmdW5jdGlvbiBsaXN0QWxsUGx1Z2lucyhhcHA6IEFwcCkge1xuICBjb25zdCBwbHVnaW5zID0gT2JqZWN0LnZhbHVlcyhhcHAucGx1Z2lucy5wbHVnaW5zKS5tYXAoKHBsdWdpbikgPT4gKHtcbiAgICBpZDogcGx1Z2luLm1hbmlmZXN0LmlkLFxuICAgIG5hbWU6IHBsdWdpbi5tYW5pZmVzdC5uYW1lLFxuICAgIHZlcnNpb246IHBsdWdpbi5tYW5pZmVzdC52ZXJzaW9uLFxuICB9KSlcbiAgcmV0dXJuIHBsdWdpbnNcbn1cbiIsImltcG9ydCB7XHJcbiAgQXBwLFxyXG4gIERlYm91bmNlcixcclxuICBNYXJrZG93blZpZXcsXHJcbiAgTm90aWNlLFxyXG4gIFBsdWdpbixcclxuICBQbHVnaW5TZXR0aW5nVGFiLFxyXG4gIFNldHRpbmcsXHJcbiAgVEZpbGUsXHJcbiAgZGVib3VuY2UsXHJcbiAgcmVxdWVzdFVybCxcclxufSBmcm9tICdvYnNpZGlhbidcclxuaW1wb3J0IHsgVklFV19UWVBFX1NUQVRTX1RSQUNLRVIgfSBmcm9tICcuL2NvbnN0YW50cydcclxuaW1wb3J0IHsgRW5jcnlwdGlvbiB9IGZyb20gJy4vaGVscGVycy9FbmNyeXB0aW9uJ1xyXG5pbXBvcnQgeyBmb3JtYXREYXRlVG9ZWVlZTU1ERCB9IGZyb20gJy4vaGVscGVycy9mb3JtYXREYXRlVG9ZWVlZTU1ERCdcclxuaW1wb3J0IHsgbGlzdEFsbFBsdWdpbnMgfSBmcm9tICcuL2hlbHBlcnMvbGlzdEFsbFBsdWdpbnMnXHJcblxyXG5jbGFzcyBEYWlseVN0YXRzU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG4gIHBsdWdpbjogRGFpbHlTdGF0c1xyXG5cclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBEYWlseVN0YXRzKSB7XHJcbiAgICBzdXBlcihhcHAsIHBsdWdpbilcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcbiAgfVxyXG5cclxuICBkaXNwbGF5KCk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpc1xyXG5cclxuICAgIGNvbnRhaW5lckVsLmVtcHR5KClcclxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ09ic2lQdWxzZSBTZXR0aW5ncycgfSlcclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoJ0xpY2Vuc2UgS2V5JylcclxuICAgICAgLnNldERlc2MoJ0VudGVyIHlvdXIgbGljZW5zZSBrZXkgdG8gYWN0aXZhdGUgT2JzaVB1bHNlIHBsdWdpbicpXHJcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgIHRleHRcclxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignWW91ciBsaWNlbnNlIGtleSBoZXJlLi4uJylcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5rZXkgfHwgJycpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmtleSA9IHZhbHVlXHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpXHJcblxyXG4gICAgICAgICAgICBjb25zdCBwYXJzZWRLZXkgPSBwYXJzZUxpY2Vuc2VLZXkodmFsdWUpXHJcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnVzZXJJZCA9IHBhcnNlZEtleS51c2VySWRcclxuICAgICAgICAgIH0pLFxyXG4gICAgICApXHJcbiAgfVxyXG59XHJcblxyXG5pbnRlcmZhY2UgV29yZENvdW50IHtcclxuICBpbml0aWFsOiBudW1iZXJcclxuICBjdXJyZW50OiBudW1iZXJcclxufVxyXG5cclxuaW50ZXJmYWNlIERhaWx5U3RhdHNTZXR0aW5ncyB7XHJcbiAgZGF5Q291bnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+XHJcbiAgdG9kYXlzV29yZENvdW50OiBSZWNvcmQ8c3RyaW5nLCBXb3JkQ291bnQ+XHJcblxyXG4gIHVzZXJJZD86IHN0cmluZ1xyXG5cclxuICBrZXk/OiBzdHJpbmdcclxufVxyXG5cclxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogRGFpbHlTdGF0c1NldHRpbmdzID0ge1xyXG4gIGRheUNvdW50czoge30sXHJcbiAgdG9kYXlzV29yZENvdW50OiB7fSxcclxuICB1c2VySWQ6IG51bGwsXHJcbn1cclxuXHJcbmludGVyZmFjZSBQYXJzZWRMaWNlbnNlS2V5IHtcclxuICBrZXk6IHN0cmluZ1xyXG4gIHVzZXJJZDogc3RyaW5nXHJcbn1cclxuXHJcbmNvbnN0IHBhcnNlTGljZW5zZUtleSA9IChrZXk6IHN0cmluZykgPT4ge1xyXG4gIC8vIGNvbnNvbGUubG9nKCctLXBhcnNpbmcga2V5Jywga2V5KVxyXG4gIGNvbnN0IHBhcnNlZEtleSA9IEVuY3J5cHRpb24oKS5kZWNyeXB0KGtleSlcclxuICAvLyBjb25zb2xlLmxvZyh7IHBhcnNlZEtleSB9KVxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB2YWx1ZSA9IEpTT04ucGFyc2UocGFyc2VkS2V5KSBhcyBQYXJzZWRMaWNlbnNlS2V5XHJcbiAgICBjb25zb2xlLmxvZyh7IHZhbHVlIH0pXHJcbiAgICByZXR1cm4gdmFsdWVcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCctLWVycm9yIGRlY3J5cHRpbmcga2V5JywgZSlcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERhaWx5U3RhdHMgZXh0ZW5kcyBQbHVnaW4ge1xyXG4gIHNldHRpbmdzOiBEYWlseVN0YXRzU2V0dGluZ3NcclxuICBzdGF0dXNCYXJFbDogSFRNTEVsZW1lbnRcclxuICBjdXJyZW50V29yZENvdW50OiBudW1iZXJcclxuICB0b2RheTogc3RyaW5nXHJcbiAgZGVib3VuY2VkVXBkYXRlOiBEZWJvdW5jZXI8W2NvbnRlbnRzOiBzdHJpbmcsIGZpbGVwYXRoOiBzdHJpbmddLCB2b2lkPlxyXG5cclxuICBkZWJvdW5jZWRVcGRhdGVEYjogRGVib3VuY2VyPFtrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZ10sIFByb21pc2U8YW55Pj5cclxuXHJcbiAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgY29uc29sZS5sb2coJy0tT2JzaWRpYW4gRXhwb3J0IFN0YXRzIFBsdWdpbiBMb2FkZWQnKVxyXG4gICAgLy8gY29uc29sZS5sb2coe1xyXG4gICAgLy8gICBkaXI6IHRoaXMuYXBwLnZhdWx0LmNvbmZpZ0RpcixcclxuICAgIC8vICAgcm9vdDogdGhpcy5hcHAudmF1bHQuZ2V0Um9vdCgpLFxyXG4gICAgLy8gICBkaXJuYW1lOiBfX2Rpcm5hbWUsXHJcbiAgICAvLyAgIG5hbWU6IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZ2V0TmFtZSgpLFxyXG4gICAgLy8gICBwYXRoOiB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmJhc2VQYXRoLFxyXG4gICAgLy8gICBpZDogdGhpcy5hcHAuYXBwSWQsXHJcbiAgICAvLyB9KVxyXG5cclxuICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKClcclxuXHJcbiAgICAvLyBjb25zdCBrZXkgPSBFbmNyeXB0aW9uKCkuZW5jcnlwdChcclxuICAgIC8vICAgSlNPTi5zdHJpbmdpZnkoeyBrZXk6ICc2S0FjWlkyeTY1OHg1NTlvQW1iTm1MNTg0MG94UW8nLCB1c2VySWQ6ICcwYjM0MTdjMDAzNzBiOThjJyB9KSxcclxuICAgIC8vIClcclxuICAgIC8vIGNvbnNvbGUubG9nKHsga2V5LCBsOiBrZXkubGVuZ3RoIH0pXHJcbiAgICAvLyBjb25zdCB0ZXN0S2V5ID0gRW5jcnlwdGlvbigpLmRlY3J5cHQoa2V5KVxyXG4gICAgLy8gY29uc29sZS5sb2coeyB0ZXN0S2V5IH0pXHJcbiAgICAvLyBwYXJzZUxpY2Vuc2VLZXkoa2V5KVxyXG5cclxuICAgIGlmICh0aGlzLnNldHRpbmdzLmtleSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHBhcnNlZEtleSA9IHBhcnNlTGljZW5zZUtleSh0aGlzLnNldHRpbmdzLmtleSlcclxuICAgICAgICB0aGlzLnNldHRpbmdzLnVzZXJJZCA9IHBhcnNlZEtleS51c2VySWRcclxuICAgICAgICBuZXcgTm90aWNlKCdPYnNpUHVsc2UgcGx1Z2luIGhhcyBiZWVuIGxvYWRlZCEnKVxyXG4gICAgICAgIHRoaXMub25MaWNlbnNlS2V5VXBkYXRlKClcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJy0tZXJyb3IgcGFyc2luZyBrZXknLCBlLCB0aGlzLnNldHRpbmdzLmtleSlcclxuICAgICAgICBuZXcgTm90aWNlKCdJbnZhbGlkIGxpY2VuY2Uga2V5IGZvciBPYnNpUHVsc2UgcGx1Z2luJylcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbmV3IE5vdGljZSgnTWlzc2luZyBsaWNlbmNlIGtleSBmb3IgT2JzaVB1bHNlIHBsdWdpbicpXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zdGF0dXNCYXJFbCA9IHRoaXMuYWRkU3RhdHVzQmFySXRlbSgpXHJcbiAgICB0aGlzLnVwZGF0ZURhdGUoKVxyXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MuZGF5Q291bnRzLmhhc093blByb3BlcnR5KHRoaXMudG9kYXkpKSB7XHJcbiAgICAgIHRoaXMudXBkYXRlQ291bnRzKClcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY3VycmVudFdvcmRDb3VudCA9IDBcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRlYm91bmNlZFVwZGF0ZSA9IGRlYm91bmNlKFxyXG4gICAgICAoY29udGVudHM6IHN0cmluZywgZmlsZXBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRoaXMudXBkYXRlV29yZENvdW50KGNvbnRlbnRzLCBmaWxlcGF0aClcclxuICAgICAgfSxcclxuICAgICAgLy8gNDAwLFxyXG4gICAgICAxMDAwLFxyXG4gICAgICBmYWxzZSxcclxuICAgIClcclxuXHJcbiAgICB0aGlzLmRlYm91bmNlZFVwZGF0ZURiID0gZGVib3VuY2UoXHJcbiAgICAgIChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRoaXMudXBkYXRlRGIoa2V5LCB2YWx1ZSlcclxuICAgICAgfSxcclxuICAgICAgMTAwMCxcclxuICAgICAgZmFsc2UsXHJcbiAgICApXHJcblxyXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLndvcmtzcGFjZS5vbigncXVpY2stcHJldmlldycsIHRoaXMub25RdWlja1ByZXZpZXcuYmluZCh0aGlzKSkpXHJcblxyXG4gICAgdGhpcy5yZWdpc3RlckludGVydmFsKFxyXG4gICAgICB3aW5kb3cuc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyRWwuc2V0VGV4dCh0aGlzLmN1cnJlbnRXb3JkQ291bnQgKyAnIHdvcmRzIHRvZGF5ICcpXHJcbiAgICAgIH0sIDIwMDApLFxyXG4gICAgKVxyXG5cclxuICAgIHRoaXMucmVnaXN0ZXJJbnRlcnZhbChcclxuICAgICAgd2luZG93LnNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICB0aGlzLnVwZGF0ZURhdGUoKVxyXG4gICAgICAgIHRoaXMuc2F2ZVNldHRpbmdzKClcclxuICAgICAgfSwgNTAwMCksXHJcbiAgICApXHJcblxyXG4gICAgaWYgKHRoaXMuYXBwLndvcmtzcGFjZS5sYXlvdXRSZWFkeSkge1xyXG4gICAgICB0aGlzLmluaXRMZWFmKClcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJFdmVudCh0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2xheW91dC1yZWFkeScsIHRoaXMuaW5pdExlYWYuYmluZCh0aGlzKSkpXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcclxuICAgICAgaWQ6ICdvcGVuLW9ic2lwdWxzZScsXHJcbiAgICAgIG5hbWU6ICdPcGVuIE9ic2lQdWxzZSBQcm9maWxlJyxcclxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMuc2V0dGluZ3MudXNlcklkKSB7XHJcbiAgICAgICAgICByZXR1cm4gbmV3IE5vdGljZSgnTWlzc2luZyBsaWNlbmNlIGtleSBmb3IgT2JzaVB1bHNlIHBsdWdpbicpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB3aW5kb3cub3BlbihgaHR0cHM6Ly93d3cub2JzaXB1bHNlLmNvbS9wcm9maWxlLyR7dGhpcy5zZXR0aW5ncy51c2VySWR9YCwgJ19ibGFuaycpXHJcbiAgICAgIH0sXHJcbiAgICB9KVxyXG5cclxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgRGFpbHlTdGF0c1NldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKVxyXG4gIH1cclxuXHJcbiAgb25MaWNlbnNlS2V5VXBkYXRlKCkge1xyXG4gICAgLy8gVE9ETzogcmVmcmVzaCB1c2VyIHBsdWdpbnMgbGlzdCBvbiB1cGRhdGVcclxuICAgIGlmICh0aGlzLnNldHRpbmdzLnVzZXJJZCkge1xyXG4gICAgICBjb25zdCBwbHVnaW5zID0gbGlzdEFsbFBsdWdpbnModGhpcy5hcHApXHJcbiAgICAgIHRoaXMudXBkYXRlRGIoXHJcbiAgICAgICAgYHVzZXIvJHt0aGlzLnNldHRpbmdzLnVzZXJJZH0vdmF1bHQvJHt0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmdldE5hbWUoKX0vcGx1Z2luc2AsXHJcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkocGx1Z2lucyksXHJcbiAgICAgIClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGluaXRMZWFmKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoVklFV19UWVBFX1NUQVRTX1RSQUNLRVIpLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uUXVpY2tQcmV2aWV3KGZpbGU6IFRGaWxlLCBjb250ZW50czogc3RyaW5nKSB7XHJcbiAgICBpZiAodGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KSkge1xyXG4gICAgICB0aGlzLmRlYm91bmNlZFVwZGF0ZShjb250ZW50cywgZmlsZS5wYXRoKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9DcmVkaXQ6IGJldHRlci13b3JkLWNvdW50IGJ5IEx1a2UgTGVwcGFuIChodHRwczovL2dpdGh1Yi5jb20vbHVrZWxlcHBhbi9iZXR0ZXItd29yZC1jb3VudClcclxuICBnZXRXb3JkQ291bnQodGV4dDogc3RyaW5nKSB7XHJcbiAgICBsZXQgd29yZHM6IG51bWJlciA9IDBcclxuXHJcbiAgICBjb25zdCBtYXRjaGVzID0gdGV4dC5tYXRjaChcclxuICAgICAgL1thLXpBLVowLTlfXFx1MDM5Mi1cXHUwM2M5XFx1MDBjMC1cXHUwMGZmXFx1MDYwMC1cXHUwNmZmXSt8W1xcdTRlMDAtXFx1OWZmZlxcdTM0MDAtXFx1NGRiZlxcdWY5MDAtXFx1ZmFmZlxcdTMwNDAtXFx1MzA5ZlxcdWFjMDAtXFx1ZDdhZl0rL2dtLFxyXG4gICAgKVxyXG5cclxuICAgIGlmIChtYXRjaGVzKSB7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0Y2hlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChtYXRjaGVzW2ldLmNoYXJDb2RlQXQoMCkgPiAxOTk2OCkge1xyXG4gICAgICAgICAgd29yZHMgKz0gbWF0Y2hlc1tpXS5sZW5ndGhcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgd29yZHMgKz0gMVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKCd0ZXh0LS0tLScsIHRleHQsIHdvcmRzLCB0ZXh0Py5sZW5ndGgpXHJcblxyXG4gICAgcmV0dXJuIHdvcmRzXHJcbiAgfVxyXG5cclxuICB1cGRhdGVXb3JkQ291bnQoY29udGVudHM6IHN0cmluZywgZmlsZXBhdGg6IHN0cmluZykge1xyXG4gICAgY29uc29sZS50aW1lKCd3b3JkQ291bnQnKVxyXG4gICAgY29uc3QgY3VyciA9IHRoaXMuZ2V0V29yZENvdW50KGNvbnRlbnRzKVxyXG4gICAgY29uc29sZS50aW1lRW5kKCd3b3JkQ291bnQnKVxyXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MuZGF5Q291bnRzLmhhc093blByb3BlcnR5KHRoaXMudG9kYXkpKSB7XHJcbiAgICAgIGlmICh0aGlzLnNldHRpbmdzLnRvZGF5c1dvcmRDb3VudC5oYXNPd25Qcm9wZXJ0eShmaWxlcGF0aCkpIHtcclxuICAgICAgICAvL3VwZGF0aW5nIGV4aXN0aW5nIGZpbGVcclxuICAgICAgICB0aGlzLnNldHRpbmdzLnRvZGF5c1dvcmRDb3VudFtmaWxlcGF0aF0uY3VycmVudCA9IGN1cnJcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvL2NyZWF0ZWQgbmV3IGZpbGUgZHVyaW5nIHNlc3Npb25cclxuICAgICAgICB0aGlzLnNldHRpbmdzLnRvZGF5c1dvcmRDb3VudFtmaWxlcGF0aF0gPSB7IGluaXRpYWw6IGN1cnIsIGN1cnJlbnQ6IGN1cnIgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvL25ldyBkYXksIGZsdXNoIHRoZSBjYWNoZVxyXG4gICAgICB0aGlzLnNldHRpbmdzLnRvZGF5c1dvcmRDb3VudCA9IHt9XHJcbiAgICAgIHRoaXMuc2V0dGluZ3MudG9kYXlzV29yZENvdW50W2ZpbGVwYXRoXSA9IHsgaW5pdGlhbDogY3VyciwgY3VycmVudDogY3VyciB9XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZUNvdW50cygpXHJcbiAgfVxyXG5cclxuICB1cGRhdGVEYXRlKCkge1xyXG4gICAgdGhpcy50b2RheSA9IGZvcm1hdERhdGVUb1lZWVlNTUREKG5ldyBEYXRlKCkpXHJcbiAgfVxyXG5cclxuICB1cGRhdGVDb3VudHMoKSB7XHJcbiAgICB0aGlzLmN1cnJlbnRXb3JkQ291bnQgPSBPYmplY3QudmFsdWVzKHRoaXMuc2V0dGluZ3MudG9kYXlzV29yZENvdW50KVxyXG4gICAgICAubWFwKCh3b3JkQ291bnQpID0+IE1hdGgubWF4KDAsIHdvcmRDb3VudC5jdXJyZW50IC0gd29yZENvdW50LmluaXRpYWwpKVxyXG4gICAgICAucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMClcclxuICAgIHRoaXMuc2V0dGluZ3MuZGF5Q291bnRzW3RoaXMudG9kYXldID0gdGhpcy5jdXJyZW50V29yZENvdW50XHJcbiAgICBjb25zb2xlLmxvZygnLS0td29yZCBjb3VudCB1cGRhdGVkJywgdGhpcy5jdXJyZW50V29yZENvdW50LCB0aGlzLnNldHRpbmdzLmRheUNvdW50cywgdGhpcy5zZXR0aW5ncylcclxuICAgIGlmICh0aGlzLmRlYm91bmNlZFVwZGF0ZURiICYmIHRoaXMuc2V0dGluZ3MudXNlcklkKSB7XHJcbiAgICAgIHRoaXMuZGVib3VuY2VkVXBkYXRlRGIoXHJcbiAgICAgICAgYHVzZXIvJHt0aGlzLnNldHRpbmdzLnVzZXJJZH0vdmF1bHQvJHt0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmdldE5hbWUoKX0vZGFpbHktY291bnRzYCxcclxuICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLnNldHRpbmdzLmRheUNvdW50cyksXHJcbiAgICAgIClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHVwZGF0ZURiKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZygnLS0tY2FsbGluZyB1cGRhdGUgZGInKVxyXG4gICAgcmV0dXJuIHJlcXVlc3RVcmwoe1xyXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgdXJsOiBgaHR0cHM6Ly9teXBpLm9uZS93ZWJob29rLzQyNDMxN2VhLTcwNWMtNDFlNC1iOTdiLTQ0MTMzN2Q0NmY1OWAsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAga2V5LFxyXG4gICAgICAgIHZhbHVlLFxyXG4gICAgICB9KSxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnLS1kYiB1cGRhdGUgZG9uZScsIHJlc3VsdClcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG4gICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuc2V0dGluZ3MuZGF5Q291bnRzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIC8vZW5zdXJpbmcgd2UgbmV2ZXIgcmVzZXQgdGhlIGRhdGEgYnkgYWNjaWRlbnRcclxuICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiY3J5cHRvIiwiUGx1Z2luU2V0dGluZ1RhYiIsIlNldHRpbmciLCJQbHVnaW4iLCJOb3RpY2UiLCJkZWJvdW5jZSIsIk1hcmtkb3duVmlldyIsInJlcXVlc3RVcmwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBb0dBO0FBQ08sU0FBUyxTQUFTLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFO0FBQzdELElBQUksU0FBUyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUs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
